<section class="" *ngIf="programs$ | async as result">
  <div class="relative py-60 bg-[url('/images/slides/slide-7.webp')] bg-cover flex flex-col overflow-hidden">
    <div
      class="absolute top-0 left-0 right-0 bottom-0 flex flex-col items-center justify-center bg-primary-950/70 gap-6 text-2xl md:text-4xl z-20 px-8 md:px-32 text-white">
      <div class="relative z-10 flex flex-col items-center py-16">
        <div class="mt-1 text-center text-2xl font-extrabold leading-tight tracking-tight sm:text-4xl">
          Que voulez-vous apprendre aujourd'hui ?
        </div>
        <div class="text-gray-300 mt-6 max-w-2xl text-center tracking-tight sm:text-2xl">
          Découvrez nos programmes et laissez-vous accompagner par les meilleurs coachs pour garantir la réussite de
          votre projet.
        </div>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div class="flex flex-auto p-6 sm:p-10">
    <div class="mx-auto flex w-full max-w-xs flex-auto flex-col sm:max-w-5xl">
      <!-- Filters -->
      <div class="flex w-full max-w-xs flex-col items-center justify-between sm:max-w-none sm:flex-row">
        <mat-form-field class="w-full sm:w-60" [subscriptSizing]="'dynamic'">
          <mat-select [value]="'all'">
            <mat-option [value]="'all'">Tous</mat-option>
            @if (result.data) {
              @for (program of result.data.programs; track $index) {
                @for (type of program.types; track $index) {
                  <mat-option [value]="type.id">{{ type.name }}</mat-option>
                }
              }
            }
          </mat-select>
        </mat-form-field>
        <!--   <mat-form-field class="mt-4 w-full sm:ml-4 sm:mt-0 sm:w-72" [subscriptSizing]="'dynamic'">
          <mat-icon matPrefix class="icon-size-5" [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
          <input placeholder="Recherchez (titre ou description)" matInput #query />
         <input (input)="filterByQuery(query.value)" placeholder="Search by title or description" matInput #query /> 
        </mat-form-field> -->
        <mat-slide-toggle class="mt-8 sm:ml-auto sm:mt-0" [color]="'primary'">
          Cacher les programmes finis
        </mat-slide-toggle>
      </div>
      <!-- Courses -->
      @if (result.data) {
        @if (result.data.programs; as programs) {
          <div class="mt-8 grid grid-cols-1 gap-8 sm:mt-10 sm:grid-cols-2 lg:grid-cols-3">
            @for (
              program of programs | paginate: { itemsPerPage: 9, currentPage, totalItems: result.data.count };
              track program.id
            ) {
              <!-- Course -->
              <div class="bg-card flex flex-col overflow-hidden rounded-2xl shadow">
                <div class="flex flex-col p-7">
                  <div class="flex items-center justify-between">
                    <!-- Course category -->
                    <div class="flex items-center gap-1">
                      @for (type of program.types; track $index) {
                        <div class="rounded-full px-3 py-0.5 text-xs font-semibold bg-green-100 text-green-800">
                          {{ type.name }}
                        </div>
                      }
                    </div>
                    <div class="flex items-center">
                      @if (isEnded(program)) {
                        <mat-icon
                          class="text-green-600 icon-size-5"
                          [svgIcon]="'heroicons_solid:check-badge'"
                          [matTooltip]="'Ce programme est fini'"></mat-icon>
                      }
                    </div>
                  </div>
                  <!-- Course title & description -->
                  <div class="mt-4 text-lg font-medium">
                    {{ program.name }}
                  </div>
                  <div class="text-secondary mt-0.5 line-clamp-2">
                    {{ program.description }}
                  </div>
                  <div class="my-6 h-1 w-12 border-t-2"></div>
                  <!-- Course time -->
                  <div class="text-secondary flex items-center text-md leading-5">
                    <mat-icon class="text-hint icon-size-5" [svgIcon]="'event'"></mat-icon>
                    <div class="ml-1.5">Débute le, {{ program.start_at | date: 'longDate' }}</div>
                  </div>
                  <div class="text-secondary flex items-center text-md leading-5 mt-2">
                    <mat-icon class="text-hint icon-size-5" [svgIcon]="'event_busy'"></mat-icon>
                    <div class="ml-1.5">Fini le, {{ program.end_at | date: 'longDate' }}</div>
                  </div>
                </div>
                <!-- Footer -->
              </div>
            }
          </div>

          <div class="flex items-center justify-center mt-16">
            <pagination-controls
              nextLabel=""
              previousLabel=""
              [autoHide]="true"
              [maxSize]="5"
              (pageChange)="onPageChange($event)"
              class="pg">
            </pagination-controls>
          </div>
        }
      } @else {
        <div class="h-40 flex flex-auto flex-col items-center justify-center bg-gray-100 mt-8">
          <mat-icon class="icon-size-24" svgIcon="search"></mat-icon>
          <div class="text-secondary mt-6 text-2xl font-semibold tracking-tight">Aucun programme !</div>
        </div>
      }
    </div>
  </div>
</section>
