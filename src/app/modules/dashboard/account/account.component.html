<div class="flex flex-col gap-4 px-8 py-10 max-w-3xl w-full" *ngIf="state$ | async as state">
  <form [formGroup]="infoForm" (submit)="updateInfo()">
    <h2 class="text-xl">Informations personnelles</h2>
    <p class="text-secondary">Mettez à jour vos informations personnelles.</p>
    @if (state.infoError || state.infoErrors.length > 0) {
      <fuse-alert class="mt-8" appearance="soft" type="error" [showIcon]="true" [@shake]="true">
        {{ state.infoError }}
        <span *ngIf="state.infoErrors.length > 0">{{ state.infoErrors | APIValidationError }}</span>
      </fuse-alert>
    }
    @if (state.infoSuccess) {
      <fuse-alert class="mt-8" appearance="soft" type="success" [showIcon]="true" [@shake]="true">
        {{ state.infoSuccess }}
      </fuse-alert>
    }
    <div class="mt-6 grid w-full gap-6 grid-cols-1 md:grid-cols-2">
      <mat-form-field class="fuse-mat-emphasized-affix w-full" [subscriptSizing]="'dynamic'">
        <mat-label>Nom</mat-label>
        <input formControlName="first_name" autocomplete="off" matInput />
      </mat-form-field>
      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label>Postnom</mat-label>
        <input formControlName="last_name" autocomplete="off" matInput />
      </mat-form-field>
      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label>Prénom</mat-label>
        <input formControlName="name" autocomplete="off" matInput />
      </mat-form-field>

      <mat-form-field class="fuse-mat-emphasized-affix w-full" [subscriptSizing]="'dynamic'">
        <mat-label>Adresse</mat-label>
        <input formControlName="address" autocomplete="off" matInput />
      </mat-form-field>

      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label>Email</mat-label>
        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:envelope'" matPrefix></mat-icon>
        <input formControlName="email" autocomplete="off" matInput />
      </mat-form-field>
      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label> Numéro de téléphone </mat-label>
        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:phone'" matPrefix></mat-icon>
        <input formControlName="phone_number" autocomplete="off" matInput />
      </mat-form-field>

      <button
        class="text-white mb-10 mt-2"
        mat-flat-button
        type="submit"
        [disabled]="state.infoIsLoading || infoForm.invalid"
        [color]="'primary'">
        @if (!state.infoIsLoading && !infoForm.invalid) {
          <span>Enregistrer les modifications</span>
        }
        @if (state.infoIsLoading) {
          <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
        }
      </button>
    </div>
  </form>

  <form [formGroup]="securityForm" (submit)="updatePassword()">
    <h2 class="text-xl">Changer le mot de passe</h2>
    <p class="text-secondary">Soyez prudent avec les informations sensibles.</p>
    @if (state.securityError || state.securityErrors.length > 0) {
      <fuse-alert class="mt-8" appearance="soft" type="error" [showIcon]="true" [@shake]="true">
        {{ state.securityError }}
        <span *ngIf="state.securityErrors.length > 0">{{ state.securityErrors | APIValidationError }}</span>
      </fuse-alert>
    }
    @if (state.securitySuccess) {
      <fuse-alert class="mt-8" appearance="soft" type="success" [showIcon]="true" [@shake]="true">
        {{ state.securitySuccess }}
      </fuse-alert>
    }

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
      <div class="col-span-2">
        <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
          <mat-label> Mot de passe actuel </mat-label>
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:key'" matPrefix></mat-icon>
          <input formControlName="old_password" type="password" matInput />
        </mat-form-field>
      </div>
      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label> Nouveau mot de passe </mat-label>
        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:key'" matPrefix></mat-icon>
        <input formControlName="password" type="password" matInput />
      </mat-form-field>
      <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
        <mat-label> Confirmer le mot de passe </mat-label>
        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:key'" matPrefix></mat-icon>
        <input formControlName="password_confirm" type="password" matInput />
      </mat-form-field>
    </div>

    <button
      class="text-white mb-10 mt-8"
      mat-flat-button
      type="submit"
      [disabled]="state.securityIsLoading || securityForm.invalid"
      [color]="'primary'">
      @if (!state.securityIsLoading && !securityForm.invalid) {
        <span>Enregistrer les modifications</span>
      }
      @if (state.securityIsLoading) {
        <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
      }
    </button>
  </form>
</div>
