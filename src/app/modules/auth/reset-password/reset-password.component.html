<div *ngIf="state$ | async as state">
  <p class="text-2xl font-extrabold leading-tight tracking-tight">Réinitialiser le mot de passe</p>
  @if (state.error) {
    <fuse-alert class="mt-8" [appearance]="'soft'" [showIcon]="true" [type]="'error'" [@shake]="true">
      {{ state.error }}
    </fuse-alert>
  }
  <form class="mt-8" [formGroup]="resetPasswordForm">
    <mat-form-field class="w-full">
      <mat-label>Code</mat-label>
      <input id="token" type="number" autocomplete="off" matInput formControlName="token" />
    </mat-form-field>
    <p class="text-sm font-bold text-red-500" *ngIf="state.errors.length > 0">
      {{ state.errors | inputError: 'token' }}
    </p>

    <mat-form-field class="w-full">
      <mat-label>Nouveau mot de passe</mat-label>
      <input id="password" matInput type="password" autocomplete="off" [formControlName]="'password'" #passwordField />
      <button
        mat-icon-button
        type="button"
        (click)="passwordField.type === 'password' ? (passwordField.type = 'text') : (passwordField.type = 'password')"
        matSuffix>
        @if (passwordField.type === 'password') {
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye'"></mat-icon>
        }
        @if (passwordField.type === 'text') {
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
        }
      </button>
    </mat-form-field>
    <p class="text-sm font-bold text-red-500" *ngIf="state.errors.length > 0">
      {{ state.errors | inputError: 'password' }}
    </p>

    <mat-form-field class="w-full">
      <mat-label>Confirmer le mot de passe</mat-label>
      <input
        id="password_confirm"
        matInput
        type="password"
        autocomplete="off"
        formControlName="password_confirm"
        #passwordConfirm />
      <button
        mat-icon-button
        type="button"
        (click)="
          passwordConfirm.type === 'password' ? (passwordConfirm.type = 'text') : (passwordConfirm.type = 'password')
        "
        matSuffix>
        @if (passwordConfirm.type === 'password') {
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye'"></mat-icon>
        }
        @if (passwordConfirm.type === 'text') {
          <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
        }
      </button>
    </mat-form-field>
    <p class="text-sm font-bold text-red-500" *ngIf="state.errors.length > 0">
      {{ state.errors | inputError: 'password_confirm' }}
    </p>

    <button
      class="fuse-mat-button-large mt-6 w-full text-white"
      mat-flat-button
      [color]="'primary'"
      [disabled]="state.isLoading || resetPasswordForm.invalid"
      (click)="resetPassword()">
      @if (!state.isLoading && !resetPasswordForm.invalid) {
        <span>Réinitialiser </span>
      }
      @if (state.isLoading) {
        <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
      }
    </button>

    <div class="mt-8 flex items-center">
      <div class="mt-px flex-auto border-t"></div>
      <div class="text-secondary mx-2">Ou continuer avec</div>
      <div class="mt-px flex-auto border-t"></div>
    </div>

    <div class="mt-8 flex items-center space-x-4">
      <button class="flex-auto" type="button" mat-stroked-button>
        <div class="flex items-center gap-1.5">
          <div class="relative h-5 w-5">
            <img ngSrc="/images/logo/google.svg" alt="Google" fill />
          </div>
          Google
        </div>
      </button>
    </div>
  </form>
</div>
