<div *ngIf="state$ | async as state">
  <div class="mb-2.5">
    <h2 class="text-2xl font-bold leading-tight tracking-tight">S'inscrire</h2>
    <div class="mt-0.5 flex items-baseline font-medium">
      <p>Ou continuer avec</p>
      <button class="ml-1 text-primary-500 hover:underline" (click)="signinWithGoogle()">Google</button>
    </div>
    @if (state.error || state.errors.length > 0) {
      <fuse-alert class="mt-8" appearance="soft" type="error" [showIcon]="true" [@shake]="true">
        {{ state.error }}
        <span *ngIf="state.errors.length > 0">{{ state.errors | APIValidationError }}</span>
      </fuse-alert>
    }
  </div>

  <form [formGroup]="signUpForm" class="-ml-6">
    <mat-stepper orientation="vertical" [color]="'primary'" [linear]="true" #stepper>
      <!-- Step 1 -->
      <mat-step label="Etape 1">
        <ng-template matStepContent>
          <mat-form-field class="w-full">
            <mat-label>Nom</mat-label>
            <input autocomplete="off" id="name" matInput formControlName="name" />
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Postnom</mat-label>
            <input autocomplete="off" id="last_name" matInput formControlName="last_name" />
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Prénom</mat-label>
            <input autocomplete="off" id="first_name" matInput formControlName="first_name" />
          </mat-form-field>
          <div>
            <button mat-button matStepperNext>Suivant</button>
          </div>
        </ng-template>
      </mat-step>

      <!-- Step 2-->
      <mat-step label="Etape 2">
        <ng-template matStepContent>
          <mat-form-field class="w-full">
            <mat-label>E-mail</mat-label>
            <input
              autocomplete="off"
              id="email"
              type="email"
              matInput
              formControlName="email"
              placeholder="example@gmail.com"
              required />
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Adresse</mat-label>
            <input
              autocomplete="off"
              id="address"
              matInput
              formControlName="address"
              placeholder="Lubumbashi, RDC."
              required />
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label> Numéro de téléphone </mat-label>
            <input
              autocomplete="off"
              id="phone_number"
              matInput
              formControlName="phone_number"
              placeholder="+243979265726"
              required />
          </mat-form-field>
          <div>
            <button mat-button matStepperPrevious>Précédent</button>
            <button mat-button matStepperNext>Suivant</button>
          </div>
        </ng-template>
      </mat-step>

      <!-- Step 3 -->
      <mat-step label="Etape 3">
        <ng-template matStepContent>
          <mat-form-field class="w-full">
            <mat-label>Mot de passe</mat-label>
            <input
              id="password"
              matInput
              type="password"
              autocomplete="off"
              [formControlName]="'password'"
              #passwordField />
            <button
              mat-icon-button
              type="button"
              (click)="
                passwordField.type === 'password' ? (passwordField.type = 'text') : (passwordField.type = 'password')
              "
              matSuffix>
              @if (passwordField.type === 'password') {
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye'"></mat-icon>
              }
              @if (passwordField.type === 'text') {
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
              }
            </button>
          </mat-form-field>

          <mat-form-field class="w-full">
            <mat-label>Confirmer le mot de passe</mat-label>
            <input
              id="password_confirm"
              matInput
              type="password"
              autocomplete="off"
              formControlName="password_confirm"
              #passwordConfirm />
            <button
              mat-icon-button
              type="button"
              (click)="
                passwordConfirm.type === 'password'
                  ? (passwordConfirm.type = 'text')
                  : (passwordConfirm.type = 'password')
              "
              matSuffix>
              @if (passwordConfirm.type === 'password') {
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye'"></mat-icon>
              }
              @if (passwordConfirm.type === 'text') {
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
              }
            </button>
          </mat-form-field>

          <div>
            <button
              class="fuse-mat-button-large mt-6 w-full text-white"
              mat-flat-button
              [color]="'primary'"
              [disabled]="state.isLoading || signUpForm.invalid"
              (click)="signUp()">
              @if (!state.isLoading && !signUpForm.invalid) {
                <span>S'inscrire</span>
              }
              @if (state.isLoading) {
                <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
              }
            </button>
          </div>
        </ng-template>
      </mat-step>
    </mat-stepper>
  </form>
</div>
